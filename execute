#!/bin/bash

USAGE="Executes given command in all repos. Meta variable REPO can be used for repository name.\n"
USAGE+="Usage: ./$(basename "$0") \"bash_code\"\n"
USAGE+="Example: ./$(basename "$0") \"echo REPO > repo-name.txt\""

if [ -z "$1" ]; then
	echo -e "$USAGE"
	exit 1
fi

MY_DIR="$(dirname "$0")"
source "$MY_DIR/util"

check_access_token

COMMAND="$1"

REPO_NAMES=$(get_repos)

for REPO in $REPO_NAMES; do
	echo "$(tput bold)=====$REPO=====$(tput sgr0)"
	cd ~/git/$REPO
	if [ $? -ne 0 ]; then
		git clone git@github.com:Scout24/$REPO.git
		cd $REPO
	fi

    eval "${COMMAND//REPO/$REPO}"

	cd ~/git

    continue
done;
